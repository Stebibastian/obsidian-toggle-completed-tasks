/* Toggle Completed Tasks Plugin Styles */

/* IMPORTANT: Order matters!
   First define EXCEPTIONS (Tasks Queries), then general rules */

/* ===== EXCEPTIONS: Tasks Plugin Queries - show ALL tasks ===== */
body.hide-completed-tasks .plugin-tasks-query-result .task-list-item.is-checked,
body.hide-completed-tasks .plugin-tasks-query-result .task-list-item {
    display: list-item !important;
}

/* Live Preview - Tasks in code blocks (queries are not affected) */
body.hide-completed-tasks .markdown-source-view.mod-cm6 .HyperMD-codeblock .HyperMD-task-line[data-task="x"] {
    display: block !important;
}

/* ===== GENERAL RULES: Hide completed tasks ===== */
/* Only outside of Tasks Plugin Queries */
/* Other status symbols remain VISIBLE: [/] in progress, [-] cancelled, [>] forwarded, etc. */

/* Reading View - ONLY hide [x] completed tasks, NOT other status symbols, NOT in Queries */
body.hide-completed-tasks .markdown-reading-view .task-list-item.is-checked:not([data-task="/"]):not([data-task="-"]):not([data-task=">"]):not([data-task="<"]):not([data-task="?"]):not([data-task="!"]):not([data-task="*"]):not([data-task='"']):not([data-task="l"]):not([data-task="b"]):not([data-task="i"]):not([data-task="S"]):not([data-task="I"]):not([data-task="p"]):not([data-task="c"]):not([data-task="f"]):not([data-task="k"]):not([data-task="w"]):not([data-task="u"]):not([data-task="d"]) {
    display: none !important;
}

/* Override above rule for Tasks Plugin Queries (higher specificity) */
body.hide-completed-tasks .plugin-tasks-query-result .task-list-item.is-checked:not([data-task="/"]):not([data-task="-"]):not([data-task=">"]):not([data-task="<"]):not([data-task="?"]):not([data-task="!"]):not([data-task="*"]):not([data-task='"']):not([data-task="l"]):not([data-task="b"]):not([data-task="i"]):not([data-task="S"]):not([data-task="I"]):not([data-task="p"]):not([data-task="c"]):not([data-task="f"]):not([data-task="k"]):not([data-task="w"]):not([data-task="u"]):not([data-task="d"]) {
    display: list-item !important;
}

/* Fallback: If data-task doesn't work, only hide classic checkboxes */
body.hide-completed-tasks .markdown-reading-view .task-list-item.is-checked:not(.task-list-item[data-task]) {
    display: none !important;
}

/* Override this rule for Tasks Plugin Queries too */
body.hide-completed-tasks .plugin-tasks-query-result .task-list-item.is-checked:not(.task-list-item[data-task]) {
    display: list-item !important;
}

/* Live Preview - ONLY hide [x] */
body.hide-completed-tasks .markdown-source-view.mod-cm6 .HyperMD-task-line[data-task="x"] {
    display: none !important;
}

/* ===== MESSAGES ===== */

/* "All tasks completed" message when list only has completed tasks */
/* ONLY for normal lists, NOT for Tasks Plugin query results */
body.hide-completed-tasks .markdown-reading-view ul.contains-task-list:has(.task-list-item):not(:has(.task-list-item:not(.is-checked)))::after {
    content: "-All tasks completed-";
    display: block;
    color: #10b981;
    font-style: italic;
    padding: 0.5em 0;
    text-align: left;
}

/* Suppress the message in Plugin query results */
body.hide-completed-tasks .markdown-reading-view .plugin-tasks-query-result ul::after,
body.hide-completed-tasks .markdown-reading-view [class*="tasks-"] ul::after,
body.hide-completed-tasks .markdown-reading-view div[class*="block-language-tasks"] ul::after {
    content: none !important;
    display: none !important;
}

/* Ribbon Icon Styling */
.toggle-completed-tasks-ribbon {
    cursor: pointer;
}
